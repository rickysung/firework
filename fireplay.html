<html>
	<head>
		<script src="/js/firework.js"></script>
		<script src="/js/singlefire.js"></script>
		<script type="text/javascript">
			var timer_tick = 100;
			var opac;
			var fireNum;
			var then = Date.now();
			var now;
			var fps = 60;
			var interval = 1000/fps;
			function start()
			{
				var ctx = document.getElementById('tutorial').getContext('2d');
				ctx.canvas.width = window.innerWidth;
				ctx.canvas.height = window.innerHeight;
				init();
			}
			function init(){
				timer_tick =100;
				if(Math.random()<0.1)
				{
					fireNum = Math.floor(getRandom(3,6));
					fireWorks = new Array(fireNum);
					for(var i=0 ; i<fireNum ; i++)
					{
						var tempP = new Point3D(getRandom(window.innerWidth*1/5,window.innerWidth*4/5),getRandom(0,window.innerHeight/2),getRandom(-500,500));
						var exdelay = getRandom(0,50);
						var exduration = getRandom(100,110);
						var fcolor = firecolor[Math.floor(getRandom(0,5))][Math.floor(getRandom(0,4))];
						fireWorks[i] = new SingleFire();
						fireWorks[i].FireInit(tempP, 25 - fireNum, 10, fcolor, exdelay, exduration-fireNum*5);
						var time = exdelay + exduration - fireNum*5;	
						if(timer_tick < time)
						{
							timer_tick = time;
						}
					}
				}
				else if(Math.random()<0.2)
				{
					fireNum = Math.floor(getRandom(1,3));
					for(var i=0 ; i<fireNum*3 ; i+=3)
					{
						var tempP = new Point3D(getRandom(window.innerWidth*1/5,window.innerWidth*4/5), getRandom(0,window.innerHeight/2), getRandom(-500,500));
						var exdelay = getRandom(0,50);
						var exduration = getRandom(130,150);
						var fcolor = firecolor[Math.floor(getRandom(0,5))][Math.floor(getRandom(0,4))];
						var fcolor_light = firecolor_light[Math.floor(getRandom(0,5))][Math.floor(getRandom(0,3))];
						var fcolor_light2 = firecolor_light[Math.floor(getRandom(0,5))][Math.floor(getRandom(0,3))];

						fireWorks[i] = new SingleFire();
						fireWorks[i+1] = new SingleFire();
						fireWorks[i+2] = new SingleFire();
						fireWorks[i].FireInit(tempP, 20, 9, fcolor, exdelay, exduration);// FireInit(Explode Location, fireNum(<30), fire velocity, fire Color)
						fireWorks[i+1].FireInit(tempP, 17, 7, fcolor_light, exdelay+10, exduration);
						fireWorks[i+2].FireInit(tempP, 15, 5, fcolor_light2, exdelay+20, exduration);
						var time = exdelay + 20 + exduration;
						if(timer_tick < time)
						{
							timer_tick = time;
						}
					}
					fireNum*=3;
				}
				else if(Math.random()<0.3)
				{
					fireNum = Math.floor(getRandom(100,120));
					var basecolor = firecolor[Math.floor(getRandom(0,5))];
					for(var i=0 ; i<fireNum ; i++)
					{
						var tempP = new Point3D(getRandom(0,window.innerWidth), getRandom(window.innerHeight*2/7,window.innerHeight*4/7), getRandom(-500,500));
						var exdelay = getRandom(30,50);
						var exduration = getRandom(40,50);
						var fcolor = basecolor[Math.floor(getRandom(0,4))];
						fireWorks[i] = new SingleFire();
						fireWorks[i].FireInit(tempP, 7, 3, fcolor, exdelay, exduration);
						var time = exdelay + exduration;
						if(timer_tick < time)
						{
							timer_tick = time;
						}
					}
				}
				else
				{
					fireNum = 1;
					var taillength = 3;
					var tempP = new Point3D(getRandom(window.innerWidth*2/5,window.innerWidth*3/5), getRandom(0,window.innerHeight/2), getRandom(-500,500));
					var exdelay = getRandom(0,50);
					var exduration = getRandom(90,120);
					var v = Math.floor(getRandom(0,5));
					var fcolor = firecolor[v][Math.floor(getRandom(0,4))];
					var fcolor_light = firecolor_light[v][Math.floor(getRandom(0,3))];
					var velocity = 10;
					var div = 30;
					fireWorks[0] = new SingleFire();
					fireWorks[0].FireInit(tempP, div, velocity, fcolor, exdelay, exduration);// FireInit(Explode Location, fireNum(<30), fire velocity, fire Color)
					for(var i=1 ; i<fireNum*taillength ; i++)
					{
						exdelay+=1;
						fireWorks[i] = new SingleFire();
						fireWorks[i].FireInit(tempP, div, velocity, fcolor_light, exdelay, exduration);
						fireWorks[i].firePoints = [];
						fireWorks[i].fireVectors = [];
						velocity ++;
						for(var j=0 ; j<fireWorks[0].fn ; j++)
						{
							fireWorks[i].firePoints[j] = new Point3D(fireWorks[0].firePoints[j].X, fireWorks[0].firePoints[j].Y, fireWorks[0].firePoints[j].Z);
							fireWorks[i].fireVectors[j] =new Vector3D(fireWorks[0].fireVectors[j].mag, new Point3D(fireWorks[0].fireVectors[j].point.X, fireWorks[0].fireVectors[j].point.Y, fireWorks[0].fireVectors[j].point.Z));
							fireWorks[i].firePoints[j].color = fcolor_light;
						}
					}
					var time = exdelay +exduration;
					if(timer_tick < time)
					{
						timer_tick = time;
					}
					fireNum *= taillength;
				}
				window.requestAnimationFrame(draw);
			}
			function draw()
			{
				now = Date.now();
				var delta = now - then;
				then = now;
				var ctx = document.getElementById('tutorial').getContext('2d');
				var cof = delta/interval;
				ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);	
				for(var j=0 ; j<fireNum ; j++)	
				{
					if(fireWorks[j].IsExplode == true && fireWorks[j].IsDone == false)
					{
						ctx.globalAlpha = fireWorks[j].opac;
						for(var i=0 ; i<fireWorks[j].fn ; i++)
						{
							ctx.fillStyle = fireWorks[j].firePoints[i].color;
							ctx.fillRect(fireWorks[j].firePoints[i].FlatX()-1,fireWorks[j].firePoints[i].FlatY()-1,2,2);
						}
					}
					fireWorks[j].progress(cof);
				}
				timer_tick--;
				if(timer_tick>0)
					window.requestAnimationFrame(draw);
				else
				{
					window.setTimeout(init,200);
				}
			}
		</script>
		<style>
		body {
			background-color : #050510;
			margin : 0;
			position : absolute;
		}
		h6 {
			color : white;
		}
		canvas {
			position : absolute;
		}
		</style>
	</head>
	<body onload = "start();">
		<canvas id = "tutorial"></canvas>
		<h6>Code by changhun.sung</h6>
	</body>
</html>
